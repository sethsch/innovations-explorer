// https://github.com/topojson/topojson-simplify v3.0.3 Copyright 2019 Mike Bostock
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("topojson-client")):"function"==typeof define&&define.amd?define(["exports","topojson-client"],n):n((r=r||self).topojson=r.topojson||{},r.topojson)}(this,function(r,n){"use strict";function e(){return!0}function t(r){return r}function o(r){return null!=r.type}function a(r){var n,e=new Array(r.arcs.length),t=0;function o(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(o);break;case"Polygon":a(r.arcs);break;case"MultiPolygon":r.arcs.forEach(a)}}function a(r){for(var n=0,o=r.length;n<o;++n,++t)for(var a=r[n],i=0,c=a.length;i<c;++i){var u=a[i];u<0&&(u=~u);var f=e[u];null==f?e[u]=t:f!==t&&(e[u]=-1)}}for(n in r.objects)o(r.objects[n]);return function(r){for(var n,t=0,o=r.length;t<o;++t)if(-1===e[(n=r[t])<0?~n:n])return!0;return!1}}function i(r){var n=r[0],e=r[1],t=r[2];return Math.abs((n[0]-t[0])*(e[1]-n[1])-(n[0]-e[0])*(t[1]-n[1]))/2}function c(r){for(var n,e=-1,t=r.length,o=r[t-1],a=0;++e<t;)n=o,o=r[e],a+=n[0]*o[1]-n[1]*o[0];return Math.abs(a)/2}function u(r,e,t){return e=null==e?Number.MIN_VALUE:+e,null==t&&(t=c),function(o,a){return t(n.feature(r,{type:"Polygon",arcs:[o]}).geometry.coordinates[0],a)>=e}}function f(r,n){return r[1][2]-n[1][2]}function l(r){return[r[0],r[1],0]}function s(r,n){return n-r}var p=Math.PI,b=2*p,y=p/4,g=p/180,h=Math.abs,m=Math.atan2,v=Math.cos,d=Math.sin;function x(r,n){for(var e,t,o=0,a=r.length,i=0,c=r[n?o++:a-1],u=c[0]*g,f=c[1]*g/2+y,l=v(f),s=d(f);o<a;++o){e=u,u=(c=r[o])[0]*g,f=c[1]*g/2+y,t=l,l=v(f);var p=u-e,b=p>=0?1:-1,h=b*p,x=s*(s=d(f)),M=t*l+x*v(h),j=x*b*d(h);i+=m(j,M)}return i}r.filter=function(r,n){var a,i=r.objects,c={};function u(r){var n,e;switch(r.type){case"Polygon":n=(e=f(r.arcs))?{type:"Polygon",arcs:e}:{type:null};break;case"MultiPolygon":n=(e=r.arcs.map(f).filter(t)).length?{type:"MultiPolygon",arcs:e}:{type:null};break;case"GeometryCollection":n=(e=r.geometries.map(u).filter(o)).length?{type:"GeometryCollection",geometries:e}:{type:null};break;default:return r}return null!=r.id&&(n.id=r.id),null!=r.bbox&&(n.bbox=r.bbox),null!=r.properties&&(n.properties=r.properties),n}function f(r){return r.length&&(e=r[0],n(e,!1))?[r[0]].concat(r.slice(1).filter(l)):null;var e}function l(r){return n(r,!0)}for(a in null==n&&(n=e),i)c[a]=u(i[a]);return function(r){var n,e,t=r.objects,o={},a=r.arcs,i=a.length,c=-1,u=new Array(i),f=0,l=-1;function s(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(s);break;case"LineString":b(r.arcs);break;case"MultiLineString":case"Polygon":r.arcs.forEach(b);break;case"MultiPolygon":r.arcs.forEach(y)}}function p(r){r<0&&(r=~r),u[r]||(u[r]=1,++f)}function b(r){r.forEach(p)}function y(r){r.forEach(b)}function g(r){var n;switch(r.type){case"GeometryCollection":n={type:"GeometryCollection",geometries:r.geometries.map(g)};break;case"LineString":n={type:"LineString",arcs:m(r.arcs)};break;case"MultiLineString":n={type:"MultiLineString",arcs:r.arcs.map(m)};break;case"Polygon":n={type:"Polygon",arcs:r.arcs.map(m)};break;case"MultiPolygon":n={type:"MultiPolygon",arcs:r.arcs.map(v)};break;default:return r}return null!=r.id&&(n.id=r.id),null!=r.bbox&&(n.bbox=r.bbox),null!=r.properties&&(n.properties=r.properties),n}function h(r){return r<0?~u[~r]:u[r]}function m(r){return r.map(h)}function v(r){return r.map(m)}for(e in t)s(t[e]);for(n=new Array(f);++c<i;)u[c]&&(u[c]=++l,n[l]=a[c]);for(e in t)o[e]=g(t[e]);return{type:"Topology",bbox:r.bbox,transform:r.transform,objects:o,arcs:n}}({type:"Topology",bbox:r.bbox,transform:r.transform,objects:c,arcs:r.arcs})},r.filterAttached=a,r.filterAttachedWeight=function(r,n,e){var t=a(r),o=u(r,n,e);return function(r,n){return t(r,n)||o(r,n)}},r.filterWeight=u,r.planarRingArea=c,r.planarTriangleArea=i,r.presimplify=function(r,e){var t=r.transform?n.transform(r.transform):l,o=function(){var r={},n=[],e=0;function t(r,e){for(;e>0;){var t=(e+1>>1)-1,o=n[t];if(f(r,o)>=0)break;n[o._=e]=o,n[r._=e=t]=r}}function o(r,t){for(;;){var o=t+1<<1,a=o-1,i=t,c=n[i];if(a<e&&f(n[a],c)<0&&(c=n[i=a]),o<e&&f(n[o],c)<0&&(c=n[i=o]),i===t)break;n[c._=t]=c,n[r._=t=i]=r}}return r.push=function(r){return t(n[r._=e]=r,e++),e},r.pop=function(){if(!(e<=0)){var r,t=n[0];return--e>0&&(r=n[e],o(n[r._=0]=r,0)),t}},r.remove=function(r){var a,i=r._;if(n[i]===r)return i!==--e&&(f(a=n[e],r)<0?t:o)(n[a._=i]=a,i),i},r}();null==e&&(e=i);var a=r.arcs.map(function(r){var n,a,i,u=[],f=0;for(a=1,i=(r=r.map(t)).length-1;a<i;++a)(n=[r[a-1],r[a],r[a+1]])[1][2]=e(n),u.push(n),o.push(n);for(r[0][2]=r[i][2]=1/0,a=0,i=u.length;a<i;++a)(n=u[a]).previous=u[a-1],n.next=u[a+1];for(;n=o.pop();){var l=n.previous,s=n.next;n[1][2]<f?n[1][2]=f:f=n[1][2],l&&(l.next=s,l[2]=n[2],c(l)),s&&(s.previous=l,s[0]=n[0],c(s))}return r});function c(r){o.remove(r),r[1][2]=e(r),o.push(r)}return{type:"Topology",bbox:r.bbox,objects:r.objects,arcs:a}},r.quantile=function(r,n){var e=[];return r.arcs.forEach(function(r){r.forEach(function(r){isFinite(r[2])&&e.push(r[2])})}),e.length&&function(r,n){if(e=r.length){if((n=+n)<=0||e<2)return r[0];if(n>=1)return r[e-1];var e,t=(e-1)*n,o=Math.floor(t),a=r[o],i=r[o+1];return a+(i-a)*(t-o)}}(e.sort(s),n)},r.simplify=function(r,n){n=null==n?Number.MIN_VALUE:+n;var e=r.arcs.map(function(r){for(var e,t=-1,o=0,a=r.length,i=new Array(a);++t<a;)(e=r[t])[2]>=n&&(i[o++]=[e[0],e[1]]);return i.length=o,i});return{type:"Topology",transform:r.transform,bbox:r.bbox,objects:r.objects,arcs:e}},r.sphericalRingArea=function(r,n){var e=x(r,!0);return n&&(e*=-1),2*(e<0?b+e:e)},r.sphericalTriangleArea=function(r){return 2*h(x(r,!1))},Object.defineProperty(r,"__esModule",{value:!0})});
